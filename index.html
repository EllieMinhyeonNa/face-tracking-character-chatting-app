<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Face Tracking Character Chat</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.11.10/p5.min.js"></script>
    <script src="https://unpkg.com/ml5@1/dist/ml5.min.js"></script>
    <script src="https://unpkg.com/peerjs@1.5.0/dist/peerjs.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        background: #f5f5f5;
        overflow: hidden;
      }

      #app-container {
        width: 100vw;
        height: 100vh;
        display: flex;
        flex-direction: column;
        background: #ffffff;
      }

      #video-grid {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 0;
        padding: 0;
        overflow: hidden;
      }

      .participant-box {
        position: relative;
        border-radius: 16px;
        overflow: hidden;
        flex: 1;
        width: 100%;
        min-height: 0;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* Host background (always left) */
      #participant-1 {
        background: #FF4A4A;
      }

      /* Guest background (always right) */
      #participant-2 {
        background: #984AFF;
      }

      .participant-label {
        position: absolute;
        top: 16px;
        left: 16px;
        background: rgba(255, 255, 255, 0.9);
        color: #333;
        padding: 8px 16px;
        border-radius: 12px;
        font-size: 16px;
        font-weight: 600;
        z-index: 10;
      }

      #canvas-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
      }

      #control-bar {
        background: #ffffff;
        border-top: 1px solid #e0e0e0;
        padding: 16px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
      }

      .duration {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .duration-label {
        font-size: 12px;
        color: #999;
        font-weight: 500;
      }

      .duration-time {
        font-size: 24px;
        font-weight: 600;
        color: #333;
      }

      .controls {
        display: flex;
        gap: 12px;
        align-items: center;
      }

      .control-btn {
        width: 56px;
        height: 56px;
        border-radius: 50%;
        border: none;
        background: #f0f0f0;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
      }

      .control-btn:hover {
        background: #e0e0e0;
      }

      .control-btn:active {
        transform: scale(0.95);
      }

      .control-btn.end-call {
        background: #FF4A4A;
        width: 64px;
        height: 64px;
      }

      .control-btn.end-call:hover {
        background: #FF3333;
      }

      .control-btn svg {
        width: 24px;
        height: 24px;
        fill: #333;
      }

      .control-btn.end-call svg {
        fill: white;
      }

      /* Responsive for desktop */
      @media (min-width: 768px) {
        #video-grid {
          flex-direction: row;
          gap: 16px;
          padding: 16px;
        }

        .participant-box {
          border-radius: 24px;
          min-height: 200px;
        }
      }

      /* Mobile adjustments */
      @media (max-width: 767px) {
        #video-grid {
          padding: 8px;
          gap: 8px;
        }
      }
    </style>
  </head>
  <body>
    <div id="app-container">
      <div id="video-grid">
        <div class="participant-box" id="participant-1">
          <div class="participant-label">host</div>
        </div>
        <div class="participant-box" id="participant-2" style="display: none;">
          <div class="participant-label">guest</div>
        </div>
      </div>

      <div id="control-bar">
        <div class="duration">
          <div class="duration-label">Duration</div>
          <div class="duration-time" id="duration-display">0:00</div>
        </div>
        <div class="controls">
          <button class="control-btn" id="mute-btn" title="Mute">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
              <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
            </svg>
          </button>
          <button class="control-btn" id="video-btn" title="Camera">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"/>
            </svg>
          </button>
          <button class="control-btn end-call" id="end-call-btn" title="End Call">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08c-.18-.17-.29-.42-.29-.7 0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28-.79-.74-1.69-1.36-2.67-1.85-.33-.16-.56-.5-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
    <!-- Constants must load first -->
    <script src="constants/keypoints.js"></script>

    <!-- Configuration loads second -->
    <script src="config.js"></script>

    <!-- Component files must load before main sketch -->
    <script src="components/eyes.js"></script>
    <script src="components/lips.js"></script>
    <script src="components/eyebrows.js"></script>

    <!-- Effects system for event-based visual effects -->
    <script src="effects/effect-manager.js"></script>
    <script src="effects/events.js"></script>
    <script src="effects/speedlines.js"></script>
    <!-- <script src="effects/hearts.js"></script> --> <!-- Example: Uncomment to enable hearts effect! -->

    <!-- Networking layer for P2P -->
    <script src="networking-peer.js"></script>

    <!-- UI controller -->
    <script src="ui.js"></script>

    <!-- Main sketch orchestrates everything -->
    <script src="sketch.js"></script>
  </body>
</html>
